name: Ejecutar Scraper y Verificador de Cursos

on:
  schedule:
   - cron: '0 3 */2 * *'  # Cada 2 d√≠as a las 3:00 AM M√©xico (3:00 AM UTC)
  
  # Permitir ejecuci√≥n manual desde GitHub
  workflow_dispatch:

jobs:
  scraper-y-verificador:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout c√≥digo
      uses: actions/checkout@v4
    
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Instalar dependencias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: 1Ô∏è‚É£ Ejecutar scraper de Discudemy
      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        # Agrega todas las variables que necesiten tus scripts
        # HOSTINGER_DB_HOST: ${{ secrets.HOSTINGER_DB_HOST }}
        # HOSTINGER_DB_USER: ${{ secrets.HOSTINGER_DB_USER }}
        # HOSTINGER_DB_PASSWORD: ${{ secrets.HOSTINGER_DB_PASSWORD }}
        # HOSTINGER_DB_NAME: ${{ secrets.HOSTINGER_DB_NAME }}
        PYTHONPATH: ${{ github.workspace }}
      run: |
        echo "üîç Iniciando scraper de Discudemy..."
        python data/scraper_discudemy.py
        echo "‚úÖ Scraper de Discudemy completado"
    
    - name: 2Ô∏è‚É£ Ejecutar verificador de cursos
      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        PYTHONPATH: ${{ github.workspace }}
      run: |
        echo "üîç Iniciando verificador de cursos..."
        python data/verificador_cursos.py
        echo "‚úÖ Verificador de cursos completado"
    
    - name: ‚úÖ Proceso completado exitosamente
      if: success()
      run: |
        echo "üéâ Ambos scripts ejecutados exitosamente"
        echo "‚è∞ Fecha y hora: $(date)"
        echo "üìä Scraper Discudemy ‚úÖ"
        echo "üîç Verificador de cursos ‚úÖ"
    
    - name: ‚ùå Error en el proceso
      if: failure()
      run: |
        echo "üí• Error durante la ejecuci√≥n"
        echo "‚è∞ Fecha y hora: $(date)"
        echo "‚ÑπÔ∏è Revisa los logs anteriores para m√°s detalles"
